# MinimalRichDomain
A minimal impact shared kernel library for basic event-sourced domain models.

### Usage
```csharp
public partial class BlogPost : EventSourcedEntity<BlogPostId>
{
    public Title Title { get; private set; }
    public uint Views { get; private set; }

#pragma warning disable CS8618 // Rehydration ensures invariants are maintained.
    public BlogPost(BlogPostId id, IReadOnlyCollection<IDomainEvent> domainEvents) : base(id, domainEvents) { }
#pragma warning restore CS8618

    private BlogPost(BlogPostId key,
                     Title title,
                     uint views)
        : base(key)
    {
        Title = title;
        Views = views;
    }

    public static BlogPost New(Title title)
    {
        var blogPost = new BlogPost(BlogPostId.New(), title);
        blogPost.RaiseAndApplyDomainEvent(new NewBlogPostPostedEvent(blogPost.Id, blogPost.Title, 1));
        return blogPost;
    }

    public void View(BloggerId viewedBy)
    {
        RaiseAndApplyDomainEvent(new BlogPostViewedEvent(Id, viewedBy, DateTimeOffset.UtcNow, NextVersion));
    }
}

public partial class BlogPost
{
    protected override void ValidateState()
    {
        if (Title is null)
            throw new InvalidOperationException("Blogger rehydrated in corrupt state. Title is missing.");
    }

    protected override void Apply(MinimalRichDomain.IDomainEvent @event)
    {
        Apply((dynamic)@event);
    }

    private void Apply(NewBlogPostPostedEvent @event)
    {
        Title = @event.Title;
        Views = 0;
    }

    private void Apply(BlogPostViewedEvent @event)
    {
        Views++;
    }
}


public sealed record class NewBlogPostPostedEvent(BlogPostId Id, Title Title, int Version) : IDomainEvent;
public sealed record class BlogPostViewedEvent(BlogPostId BlogPostId, BloggerId ViewedBy, DateTimeOffset ViewedAt, int Version) : IDomainEvent;
```

## MinimalRichDomain.SourceGenerators
Source generator for Id value objects for domain entities.

### Usage

```charp
[GenerateId]
public class BlogPost
{
    public BlogPostId Id { get; } // Type generated by the source generator
}
```

Generated struct:

```csharp
"using System;

#nullable enable
namespace SameNameSpaceAsEntityIdWasGeneratedFrom;

public readonly partial struct BlogPostId
{
    public Guid Value { get; }

    public static BlogPostId Empty => new(Guid.Empty);

    private BlogPostId(Guid value)
    {
        Value = value;
    }

    public static BlogPostId New() => new(Guid.NewGuid());

    public static BlogPostId FromValue(Guid value) => new(value);

    public static bool operator ==(BlogPostId left, BlogPostId right)
    {
        return left.Equals(right);
    }

    public static bool operator !=(BlogPostId left, BlogPostId right)
    {
        return !left.Equals(right);
    }

    public override bool Equals(object? obj)
    {
        if(obj is not BlogPostId other)
            return false;
        else
            return Value == other.Value;
    }

    public override int GetHashCode()
    {
        return Value.GetHashCode();
    }

    public override string? ToString()
    {
        return Value.ToString();
    }
}
#nullable restore
```